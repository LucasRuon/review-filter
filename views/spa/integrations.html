<style>
    .integrations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; }
    .integration-card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .integration-header { padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 1rem; }
    .integration-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .integration-icon.whatsapp { background: #25D366; color: white; }
    .integration-icon.webhook { background: #6366F1; color: white; }
    .integration-info h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem; }
    .integration-info p { font-size: 0.85rem; color: var(--text-secondary); }
    .integration-body { padding: 1.5rem; }
    .integration-status { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; }
    .status-dot.connected { background: #22C55E; }
    .status-dot.disconnected { background: #EF4444; }
    .status-dot.connecting { background: #F59E0B; animation: pulse 1.5s ease-in-out infinite; }
    .status-dot.pending { background: #9CA3AF; }
    .status-text { font-size: 0.85rem; font-weight: 500; }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.show { display: flex; }
    .modal-content { background: var(--bg-secondary); border-radius: var(--radius); padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .modal-title { font-size: 1.25rem; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); }
    .qrcode-container { background: white; padding: 1rem; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 1rem 0; min-height: 250px; }
    .qrcode-container img { max-width: 250px; width: 100%; }
    .btn-group { display: flex; gap: 0.5rem; margin-top: 1rem; }

    .toggle-switch { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.75rem; }
    .toggle-switch-label { font-size: 0.9rem; font-weight: 500; }
    .toggle-switch-hint { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; }
    .toggle-input { width: 44px; height: 24px; background: var(--border); border-radius: 12px; position: relative; cursor: pointer; transition: background 0.2s; appearance: none; -webkit-appearance: none; }
    .toggle-input:checked { background: #25D366; }
    .toggle-input::before { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: transform 0.2s; }
    .toggle-input:checked::before { transform: translateX(20px); }

    .section-divider { border-top: 1px solid var(--border); margin: 1.25rem 0; padding-top: 1.25rem; }
    .section-title { font-size: 0.9rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Estilos para lista de instancias */
    .instances-list { display: flex; flex-direction: column; gap: 1rem; }
    .instance-card { background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; }
    .instance-card.free { border-left: 3px solid #22C55E; }
    .instance-card.paid { border-left: 3px solid #F59E0B; }
    .instance-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; }
    .instance-name { font-weight: 600; font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem; }
    .instance-badge { font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 500; }
    .instance-badge.free { background: rgba(34, 197, 94, 0.1); color: #22C55E; }
    .instance-badge.paid { background: rgba(245, 158, 11, 0.1); color: #F59E0B; }
    .instance-client { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .instance-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .instance-actions .btn { font-size: 0.8rem; padding: 0.4rem 0.75rem; }

    .add-instance-btn { width: 100%; padding: 1rem; border: 2px dashed var(--border); border-radius: 12px; background: transparent; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; }
    .add-instance-btn:hover { border-color: var(--primary); color: var(--primary); background: rgba(55, 80, 240, 0.05); }
    .add-instance-price { font-size: 0.85rem; opacity: 0.8; }

    .empty-state { text-align: center; padding: 2rem; color: var(--text-secondary); }
    .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
    .empty-state p { margin-bottom: 1rem; }
</style>

<div class="page-header">
    <h1 class="page-title"><i class="fas fa-plug"></i> Integracoes</h1>
    <p class="page-subtitle">Conecte WhatsApp e outras plataformas</p>
</div>

<div class="integrations-grid">
    <!-- WhatsApp Business -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-icon whatsapp"><i class="fab fa-whatsapp"></i></div>
            <div class="integration-info">
                <h3>WhatsApp Business</h3>
                <p>Envie notificacoes automaticas por cliente</p>
            </div>
        </div>
        <div class="integration-body">
            <div id="whatsapp-instances-container">
                <div class="empty-state" id="whatsapp-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando instancias...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Webhook -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-icon webhook"><i class="fas fa-plug"></i></div>
            <div class="integration-info">
                <h3>Webhook</h3>
                <p>Integre com seu sistema via HTTP POST</p>
            </div>
        </div>
        <div class="integration-body">
            <div class="integration-status">
                <div class="status-dot" id="webhook-status-dot"></div>
                <span class="status-text" id="webhook-status-text">Nao configurado</span>
            </div>
            <div class="form-group">
                <label class="form-label">URL do Webhook</label>
                <input type="url" id="webhookUrl" class="form-input" placeholder="https://seu-sistema.com/webhook" value="">
                <p class="form-hint">Recebe POST com JSON contendo os dados da reclamacao</p>
            </div>
            <div class="form-group">
                <label class="form-label">Header de autenticacao (opcional)</label>
                <input type="text" id="webhookHeader" class="form-input" placeholder="Bearer seu-token-aqui" value="">
                <p class="form-hint">Enviado no header Authorization</p>
            </div>
            <button class="btn btn-primary" onclick="saveWebhookConfig()"><i class="fas fa-save"></i> Salvar</button>
            <button class="btn btn-secondary" onclick="testWebhook()" style="margin-top:0.5rem"><i class="fas fa-vial"></i> Testar webhook</button>
        </div>
    </div>
</div>

<!-- Modal QR Code -->
<div class="modal" id="qrCodeModal">
    <div class="modal-content" style="text-align: center;">
        <div class="modal-header">
            <h2 class="modal-title">Conectar WhatsApp</h2>
            <button class="modal-close" onclick="closeQRModal()">&times;</button>
        </div>
        <div class="qrcode-container" id="qrCodeContainer">
            <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #25D366;"></i>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.9rem;">Escaneie o QR Code com o WhatsApp</p>
        <button class="btn btn-secondary" onclick="closeQRModal()" style="width: 100%; margin-top: 1rem;">
            <i class="fas fa-times"></i> Cancelar
        </button>
    </div>
</div>

<!-- Modal Configuracao de Instancia -->
<div class="modal" id="instanceConfigModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Configurar Instancia</h2>
            <button class="modal-close" onclick="closeInstanceConfigModal()">&times;</button>
        </div>

        <input type="hidden" id="configInstanceId">

        <div class="form-group">
            <label class="form-label">Cliente Vinculado</label>
            <select id="configClientId" class="form-input">
                <option value="">-- Nenhum cliente --</option>
            </select>
            <p class="form-hint">Selecione o cliente que usara esta instancia</p>
        </div>

        <div class="section-divider"></div>
        <div class="section-title">Notificacao de Nova Reclamacao</div>

        <div class="toggle-switch">
            <div>
                <div class="toggle-switch-label">Notificar novas reclamacoes</div>
                <div class="toggle-switch-hint">Envia mensagem quando uma nova reclamacao e recebida</div>
            </div>
            <input type="checkbox" class="toggle-input" id="configNotifyNew" checked>
        </div>

        <div class="form-group">
            <label class="form-label">Mensagem de nova reclamacao</label>
            <textarea id="configMessageNew" class="form-input" rows="4" placeholder="Digite a mensagem..."></textarea>
            <p class="form-hint">Variaveis: {cliente}, {filial}, {nome}, {email}, {telefone}, {topico}, {reclamacao}</p>
        </div>

        <div class="form-group">
            <label class="form-label">Enviar para</label>
            <select id="configSendToType" class="form-input" onchange="toggleConfigDestination()">
                <option value="contact">Contato individual</option>
                <option value="group">Grupo do WhatsApp</option>
            </select>
        </div>

        <div class="form-group" id="config-contact-group">
            <label class="form-label">Numero do contato</label>
            <input type="tel" id="configContactNumber" class="form-input" placeholder="5511999999999">
        </div>

        <div class="form-group" id="config-group-group" style="display: none;">
            <label class="form-label">Selecione o grupo</label>
            <select id="configGroupJid" class="form-input">
                <option value="">Carregando grupos...</option>
            </select>
            <button class="btn btn-secondary" onclick="loadInstanceGroups()" style="margin-top: 0.5rem; width: 100%;">
                <i class="fas fa-sync"></i> Recarregar grupos
            </button>
        </div>

        <div class="section-divider"></div>
        <div class="section-title">Notificacao de Status ao Cliente</div>

        <div class="toggle-switch">
            <div>
                <div class="toggle-switch-label">Notificar mudanca de status</div>
                <div class="toggle-switch-hint">Envia mensagem ao cliente quando o status muda</div>
            </div>
            <input type="checkbox" class="toggle-input" id="configNotifyStatus" checked>
        </div>

        <div class="form-group">
            <label class="form-label">Mensagem "Em andamento"</label>
            <textarea id="configMessageInProgress" class="form-input" rows="3" placeholder="Digite a mensagem..."></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">Mensagem "Resolvido"</label>
            <textarea id="configMessageResolved" class="form-input" rows="3" placeholder="Digite a mensagem..."></textarea>
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="closeInstanceConfigModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="saveInstanceConfig()" style="flex: 1;">
                <i class="fas fa-save"></i> Salvar Configuracoes
            </button>
        </div>
    </div>
</div>

<!-- Script movido para app.html para funcionar com SPA innerHTML -->
